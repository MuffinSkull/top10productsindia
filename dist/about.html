<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>About</title>
    </head>

    <body>
        <h1>About</h1>
    </body>
</html>

 <?php
/**
 * Plugin Name: Event Importer
 * Plugin URI: https://www.example.com/
 * Description: Import venues, organizers, and events from a CSV file.
 * Version: 1.0
 * Author: Your Name
 * Author URI: https://www.example.com/
 */

// Add the event importer menu item
function event_importer_menu() {
	add_submenu_page( 'edit.php?post_type=tribe_events', 'Event Importer', 'Event Importer', 'manage_options', 'event_importer', 'event_importer_page' );
}
add_action( 'admin_menu', 'event_importer_menu' );

// Display the event importer page
function event_importer_page() {
	?>
	<div class="wrap">
		<h1>Event Importer</h1>

		<form method="post" enctype="multipart/form-data">
			<label for="csv_file">CSV File:</label>
			<input type="file" name="csv_file" id="csv_file" />
			<br />
			<input type="submit" name="submit" value="Import" />
		</form>
	</div>
	<?php
}

// Handle the CSV file upload and import
function event_importer() {
	if ( isset( $_POST['submit'] ) ) {
		// Get the uploaded file
		$file = $_FILES['csv_file']['tmp_name'];

		// Open the uploaded file
		$handle = fopen($file, "r");

		// Skip the header row
		fgetcsv($handle);

		// Loop through the remaining rows
		while (($data = fgetcsv($handle, 1000, ",")) !== FALSE) {
			// Parse the data from the current row
			$event_name = $data[0];
			$event_description = $data[1];
			$start_date = $data[2];
			$end_date = $data[3];
			$start_time = $data[4];
			$end_time = $data[5];
			$venue_name = $data[6];
			$venue_address = $data[7];
			$organizer_name = $data[8];
			$organizer_email = $data[9];
			$organizer_phone = $data[10];
			$organizer_website = $data[11];

			// Check if the venue already exists
			$venue = tribe_get_venue_by_name($venue_name);

			// If the venue doesn't exist, create a new one
			if (empty($venue)) {
				$venue_id = tribe_create_venue(array(
					'post_title' => $venue_name,
					'post_content' => $venue_address
				));
			} else {
				$venue_id = $venue->ID;
			}

			// Check if the organizer already exists
			$organizer = tribe_get_organizer_by_name($organizer_name);

			// If the organizer doesn't exist, create a new one
			if (empty($organizer)) {
				$organizer_id = tribe_create_organizer(array(
					'post_title' => $organizer_name,
					'post_content' => '',
					'email' => $organizer_email,
					'phone' => $organizer_phone,
					'website' => $organizer_website
				));
			} else {
				$organizer_id = $organizer->ID;
			}

			// Create the event
        $event_id = tribe_create_event(array(
            'post_title' => $event_name,
            'post_content' => $event_description,
            'EventStartDate' => $start_date,
            'EventEndDate' => $end_date,
            'EventStartHour' => date('H', strtotime($start_time)),
            'EventStartMinute' => date('i', strtotime($start_time)),
            'EventEndHour' => date('H', strtotime($end_time)),
            'EventEndMinute' => date('i', strtotime($end_time)),
            'Venue' => $venue_id,
            'Organizer' => $organizer_id
        ));
    

    // Close the uploaded file
    fclose($handle);
}
}
add_action('admin_post_event_importer', 'event_importer
?>
